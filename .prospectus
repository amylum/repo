Dir.glob('*/PKGBUILD').each do |pkgbuild|
  package = File.dirname pkgbuild
  lines = File.readlines(pkgbuild)
  url = lines.find { |x| x.match(/^url=/) }.split('"')[1]

  dummy = lines.find { |x| x.match(/^_dummy=true/) }
  next if dummy

  version_line = lines.find { |x| x.match(/^pkgver=/) }.chomp
  version = version_line.split('=', 2).last.gsub('_', '-')

  item do
    name "repo::#{package}"

    expected do
      github_release
      repo url.split('.com/').last
    end

    actual do
      static
      set version
    end
  end
end

item do
  name 'repo::pacman-mirrorlist-amylum'

  expected do
    static
    set Time.now.strftime('%Y%m')
  end

  actual do
    static
    file_lines = File.readlines('pacman-mirrorlist-amylum/PKGBUILD')
    version_string = file_lines.find { |x| x.match(/^pkgver/) }.chomp
    year_month = version_string.split('=').last[0..5]
    set year_month
  end
end
